{"version":3,"file":"index.js","sources":["host/key_for.ts","host/sound.ts","host/graphics/program.ts","host/graphics/quad.ts","host/graphics.ts","host/host.ts","index.ts"],"sourcesContent":["const enum KeyCodes {\n  KEY_X = 88,\n  KEY_1 = 49,\n  KEY_2 = 50,\n  KEY_3 = 51,\n  KEY_Q = 81,\n  KEY_W = 87,\n  KEY_E = 69,\n  KEY_A = 65,\n  KEY_S = 83,\n  KEY_D = 68,\n  KEY_Z = 90,\n  KEY_C = 67,\n  KEY_4 = 52,\n  KEY_R = 82,\n  KEY_F = 70,\n  KEY_V = 86\n}\n\nexport const enum Keys {\n  NONE  = -1,\n  KEY_0 = 0x0,\n  KEY_1 = 0x1,\n  KEY_2 = 0x2,\n  KEY_3 = 0x3,\n  KEY_4 = 0x4,\n  KEY_5 = 0x5,\n  KEY_6 = 0x6,\n  KEY_7 = 0x7,\n  KEY_8 = 0x8,\n  KEY_9 = 0x9,\n  KEY_A = 0xA,\n  KEY_B = 0xB,\n  KEY_C = 0xC,\n  KEY_D = 0xD,\n  KEY_E = 0xE,\n  KEY_F = 0xF\n}\n\nexport default function keyFor(keyCode: number): Keys {\n  switch (keyCode) {\n    case KeyCodes.KEY_X: return Keys.KEY_0;\n    case KeyCodes.KEY_1: return Keys.KEY_1;\n    case KeyCodes.KEY_2: return Keys.KEY_2;\n    case KeyCodes.KEY_3: return Keys.KEY_3;\n    case KeyCodes.KEY_Q: return Keys.KEY_4;\n    case KeyCodes.KEY_W: return Keys.KEY_5;\n    case KeyCodes.KEY_E: return Keys.KEY_6;\n    case KeyCodes.KEY_A: return Keys.KEY_7;\n    case KeyCodes.KEY_S: return Keys.KEY_8;\n    case KeyCodes.KEY_D: return Keys.KEY_9;\n    case KeyCodes.KEY_Z: return Keys.KEY_A;\n    case KeyCodes.KEY_C: return Keys.KEY_B;\n    case KeyCodes.KEY_4: return Keys.KEY_C;\n    case KeyCodes.KEY_R: return Keys.KEY_D;\n    case KeyCodes.KEY_F: return Keys.KEY_E;\n    case KeyCodes.KEY_V: return Keys.KEY_F;\n    default: return Keys.NONE;\n  }\n}","declare const webkitAudioContext: typeof AudioContext;\nconst context = typeof AudioContext !== \"undefined\" ? new AudioContext() : <AudioContext>new webkitAudioContext();\n\nexport default class Sound {\n  oscillator: OscillatorNode | undefined = undefined;\n\n  startTone() {\n    if (this.oscillator) {\n      this.oscillator.stop();\n    }\n    let oscillator = this.oscillator = context.createOscillator();\n    oscillator.type = 'square';\n    oscillator.frequency.value = 262;\n    oscillator.connect(context.destination);\n    oscillator.start((context.currentTime % 262)/ 1000);\n  }\n\n  stopTone() {\n    let oscillator = this.oscillator;\n    if (oscillator) {\n      oscillator.stop((context.currentTime % 262)/ 1000);\n      this.oscillator = undefined;\n    }\n  }\n}\n","export interface Drawable {\n  draw(program: WebGLProgram): void;\n}\n\nexport default class Program {\n  program: WebGLProgram;\n\n  constructor(private gl: WebGLRenderingContext) {\n    let program = gl.createProgram();\n    if (!program) throw new Error(\"failed to create program\");\n    this.program = program;\n  }\n\n  attachVertexShader(source: string) {\n    this.attachShader(this.gl.VERTEX_SHADER, source);\n  }\n\n  attachFragmentShader(source: string) {\n    this.attachShader(this.gl.FRAGMENT_SHADER, source);\n  }\n\n  attachShader(type: number, source: string) {\n    let { gl, program } = this;\n    let shader = gl.createShader(type);\n    if (!shader) throw new Error(\"failed to create shader\");\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      let log = gl.getShaderInfoLog(shader);\n      throw new Error(log || \"compile shader failed\");\n    }\n    gl.attachShader(program, shader);\n  }\n\n  link() {\n    let { gl, program } = this;\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      let log = gl.getProgramInfoLog(program);\n      throw new Error(log || \"link program failed\");\n    }\n  }\n\n  draw(drawable: Drawable) {\n    drawable.draw(this.program);\n  }\n\n  uniformLocation(name: string) {\n    return this.gl.getUniformLocation(this.program, name);\n  }\n\n  attributeLocation(name: string) {\n    return this.gl.getAttribLocation(this.program, name);\n  }\n}\n","import Program, { Drawable } from \"./program\";\n\nconst VERTEX_SHADER = `\nprecision lowp float;\nattribute vec2 vertex;\nvarying vec2 uv;\nconst vec2 scale = vec2(0.5, 0.5);\nvoid main()\n{\n  // map -1 to 1 to 0 to 1\n  uv  = vertex * scale + scale;\n  gl_Position = vec4(vertex, 0.0, 1.0);\n}\n`;\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D screen;\nvarying vec2 uv;\nvoid main()\n{\n  gl_FragColor = texture2D(screen, uv);\n}\n`\n\nconst VERTICES = new Float32Array([\n  -1,  1,\n  -1, -1,\n   1,  1,\n   1, -1\n]);\n\nexport default class Quad implements Drawable {\n  buffer: WebGLBuffer;\n  texture: WebGLTexture;\n\n  program: Program;\n\n  uniforms: { screen: WebGLUniformLocation };\n  attributes: { vertex: number };\n\n  tick: () => void;\n\n  constructor(private gl: WebGLRenderingContext) {\n    let buffer = gl.createBuffer();\n    if (!buffer) throw new Error(\"failed to create quad buffer\");\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, VERTICES, gl.STATIC_DRAW);\n\n    let texture = gl.createTexture();\n    if (!texture) throw new Error(\"failed to create quad buffer\");\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    let program = new Program(gl);\n    program.attachVertexShader(VERTEX_SHADER);\n    program.attachFragmentShader(FRAGMENT_SHADER);\n    program.link();\n\n    let screen = program.uniformLocation(\"screen\");\n    if (screen === null) throw new Error(\"missing uniform screen\");\n\n    let uniforms = {\n      screen\n    };\n\n    let attributes = {\n      vertex: program.attributeLocation(\"vertex\")\n    };\n\n    gl.enableVertexAttribArray(attributes.vertex);\n\n    let tick = () => {\n      this.render();\n      requestAnimationFrame(tick);\n    }\n    requestAnimationFrame(tick);\n\n    this.buffer = buffer;\n    this.texture = texture;\n    this.program = program;\n    this.uniforms = uniforms;\n    this.attributes = attributes;\n    this.tick = tick;\n  }\n\n  draw(program: WebGLProgram) {\n    let { gl, attributes, uniforms } = this;\n    gl.useProgram(program);\n    gl.vertexAttribPointer(attributes.vertex, 2, gl.FLOAT, false, 0, 0);\n    gl.uniform1i(uniforms.screen, 0);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n  render() {\n    this.program.draw(this);\n  }\n\n  uploadTexture(rgb: Uint8Array, width: number, height: number) {\n    let { gl, texture } = this;\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, width, height, 0, gl.RGB, gl.UNSIGNED_BYTE, rgb);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  }\n}\n","import Quad from \"./graphics/quad\";\n\nconst WIDTH = 64;\nconst HEIGHT = 32;\n\nconst enum Color {\n  Black = 0x00,\n  White = 0xFF\n}\n\nconst enum Pixel {\n  Off = 0,\n  On = 1\n}\n\nconst ColorMap = {\n  [Pixel.Off]: Color.Black,\n  [Pixel.On]: Color.White\n};\n\nexport default class Graphics {\n  rgb: Uint8Array;\n  quad: Quad;\n\n  constructor(private gl: WebGLRenderingContext) {\n    let quad = this.quad = new Quad(gl);\n    let rgb = this.rgb = new Uint8Array(WIDTH * HEIGHT * 3);\n    quad.uploadTexture(rgb, WIDTH, HEIGHT);\n  }\n\n  draw(pixels: Uint8Array): void {\n    let rgb = this.rgb;\n    for (let y = 0; y < HEIGHT; y++) {\n      for (let x = 0; x < WIDTH; x++) {\n        let pixelIndex = y * WIDTH + x;\n        let color = ColorMap[pixels[pixelIndex]];\n        let index = pixelIndex * 3;\n        rgb[index]     = color;\n        rgb[index + 1] = color;\n        rgb[index + 2] = color;\n      }\n    }\n\n    this.quad.uploadTexture(rgb, WIDTH, HEIGHT);\n  }\n}\n","import keyFor, { Keys } from \"./key_for\";\nimport Sound from \"./sound\";\nimport Graphics from \"./graphics\";\n\nexport default class Chip8Host {\n  private sound: Sound;\n  private graphics: Graphics;\n\n  constructor(private worker: Worker, window: Window, private input: HTMLInputElement, gl: WebGLRenderingContext) {\n    this.graphics = new Graphics(gl);\n    this.sound = new Sound();\n    worker.onmessage = this.onmessage.bind(this);\n    worker.onerror = this.onerror.bind(this);\n    window.onkeydown = this.onkeydown.bind(this);\n    window.onkeyup = this.onkeyup.bind(this);\n    input.onchange = this.onchange.bind(this);\n  }\n\n  onmessage(msg: MessageEvent) {\n    switch (msg.data.cmd) {\n      case \"draw\":\n        this.graphics.draw(msg.data.pixels);\n        break;\n      case \"startTone\":\n        this.sound.startTone();\n        break;\n      case \"stopTone\":\n        this.sound.stopTone();\n        break;\n      default:\n        throw new Error(`unknown command ${msg.data.cmd}`);\n    }\n  }\n\n  onchange() {\n    let files = this.input.files;\n    if (!files || files.length === 0) return;\n    let rom = files[0];\n    this.worker.postMessage({ cmd: \"load\", rom });\n  }\n\n  onkeydown(evt: KeyboardEvent) {\n    let key = keyFor(evt.keyCode);\n    if (key === Keys.NONE) return;\n    this.worker.postMessage({ cmd: \"keydown\", key });\n  }\n\n  onkeyup(evt: KeyboardEvent) {\n    let key = keyFor(evt.keyCode);\n    if (key === Keys.NONE) return;\n    this.worker.postMessage({ cmd: \"keyup\", key });\n  }\n\n  onerror(evt: ErrorEvent) {\n    console.error(evt.error);\n  }\n}\n","import Host from \"./host/host\";\n\nconst canvas = document.getElementById(\"screen\") as HTMLCanvasElement;\nconst input = document.querySelector('input[type=\"file\"]') as HTMLInputElement;\nconst gl = getWebGLContext(canvas);\nif (gl == null) throw new Error(\"failed to get gl context\");\nconst worker = new Worker(\"worker/chip8.js\");\nconst host = new Host(worker, self, input, gl);\n\nfunction getWebGLContext(canvas: HTMLCanvasElement): WebGLRenderingContext {\n  let gl = canvas.getContext(\"webgl\");\n  if (!gl) throw new Error(\"no webgl\");\n  return gl;\n}\n"],"names":["const","let","Host"],"mappings":"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"}